<script src="aframe.min.js"></script>
<script src="aframe-ar-nft.js"></script>
<style>
    /* Ensure the scene takes up the full viewport */
    body {
        margin: 0;
        overflow: hidden;
        background-color: black;
    }

    /* Style for the full-screen GIF */
    #fullscreen-gif {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        object-fit: cover;
        /* Covers the screen without distortion */
        z-index: 10;
        /* Above AR content */
        display: none;
        /* Hidden initially */
    }

    #game-title {
        position: fixed;
        top: 10%;
        /* Position at 10% height from the top */
        left: 50%;
        transform: translateX(-50%);
        /* Center horizontally */
        width: 75vw;
        /* Fit 75% of screen width */
        height: auto;
        /* Maintain aspect ratio */
        z-index: 5;
        /* Below GIF but above AR content */
        opacity: 0;
        /* Initially visible */
        transition: opacity 0.5s ease;
        /* Smooth fade animation */
    }
</style>

<body>

    <img id="game-title" src="title.png">
    <!-- Full-screen GIF element -->
    <img id="fullscreen-gif" src="Banana_GIF.gif" alt="Full-screen GIF">

    <!-- A-Frame scene with AR.js for NFT image tracking -->
    <a-scene vr-mode-ui="enabled: false;" renderer="logarithmicDepthBuffer: true;" embedded
        arjs="sourceType: webcam; detectionMode: mono_and_matrix; matrixCodeType: 3x3; trackingMethod: best; debugUIEnabled: false;">
        <!-- NFT marker for image tracking -->
        <a-nft type="nft" url="ken/test" smooth="true" smoothCount="10" smoothTolerance="0.01" smoothThreshold="5"
            emitevents="true">
            <!-- Empty entity to trigger events -->
            <a-entity></a-entity>
        </a-nft>
        <!-- Camera -->
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // Get the NFT marker and GIF elements
        const marker = document.querySelector('a-nft');
        const gif = document.querySelector('#fullscreen-gif');
        const title = document.querySelector('#game-title');
        const scene = document.querySelector('a-scene');

        // Store the original GIF source to reset it
        const gifSrc = gif.src;

        // Function to find the webcam video element and attach canplay event
        function waitForWebcam() {
            const video = document.querySelector('video');
            if (video) {
                // Fade in title when webcam stream is ready
                video.addEventListener('canplay', () => {
                    title.style.opacity = '1'; // Fade in title
                }, {
                    once: true
                });
            } else {
                // Retry if video element is not yet available
                setTimeout(waitForWebcam, 100);
            }
        }

        // Start checking for webcam video after scene is loaded
        scene.addEventListener('loaded', () => {
            waitForWebcam();
        });

        // Show GIF when marker is detected
        marker.addEventListener('markerFound', () => {
            gif.style.display = 'block';
            title.style.opacity = '0'; // Fade out title
        });

        // Hide GIF when marker is lost
        marker.addEventListener('markerLost', () => {
            gif.style.display = 'none';
            gif.src = ''; // Clear src to stop playback
            gif.src = gifSrc + '?t=' + new Date().getTime(); // Reset GIF by reloading with a timestamp
            title.style.opacity = '1'; // Fade in title
        });
    </script>
</body>